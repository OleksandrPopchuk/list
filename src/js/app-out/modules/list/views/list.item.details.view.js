define(function(a){var b,c=a("underscore"),d=(a("jquery"),a("template.collection")),e=a("common/base.view"),f=a("modules/list/collections/list.collection");return b=e.extend({collection:f,template:d["list.item.details.hbs"],currentItem:null,photoChanged:!1,overlay:null,additionalEvents:{"click .fn-contact-remove":"handleRemoveContact","click .fn-contact-remove-cancel":"removeContactCancel","click .fn-contact-remove-confirm":"removeContact","click .fn-contact-edit":"activateEditMode","click .fn-contact-cancel":"deactivateEditMode","click .fn-contact-save":"saveContact","click .fn-edit-photo.editable":"editPhoto","change .fn-photo-upload":"uploadPhoto"},events:function(){return c.extend(e.prototype.events,this.additionalEvents)},initialize:function(){this.listenTo(this.collection,"change",function(a){this.render(a.attributes)})},render:function(a){return this.$el.html(this.template(a)),this.currentItem=a,this.overlay=this.$el.find(".fn-contact-details-overlay"),this},activateEditMode:function(){var a=this.$el.find(".fn-edit-photo"),b=this.$el.find(".fn-edit-input"),c=this.$el.find(".data-span"),d=this.$el.find(".fn-contact-edit"),e=this.$el.find(".fn-contact-remove"),f=this.$el.find(".fn-contact-save"),g=this.$el.find(".fn-contact-cancel");a.addClass("editable"),c.addClass("hidden"),d.addClass("hidden"),e.addClass("hidden"),b.removeClass("hidden"),f.removeClass("hidden"),g.removeClass("hidden")},deactivateEditMode:function(){var a=this.$el.find(".fn-edit-photo"),b=this.$el.find(".photo"),c=this.$el.find(".fn-photo-upload"),d=this.$el.find(".fn-edit-input"),e=this.$el.find(".data-span"),f=this.$el.find(".fn-contact-edit"),g=this.$el.find(".fn-contact-remove"),h=this.$el.find(".fn-contact-save"),i=this.$el.find(".fn-contact-cancel"),j=b.attr("src").match(/(.*\/)/g);a.removeClass("editable"),b.attr("src",j+this.model.get("photo")),c.val(""),e.removeClass("hidden"),f.removeClass("hidden"),g.removeClass("hidden"),d.addClass("hidden"),h.addClass("hidden"),i.addClass("hidden")},saveContact:function(){var a,b,c=this.$el.find(".fn-edit-input"),d=this.$el.find(".fn-photo-upload");c.each(function(d){a=c[d],b=a.value,this.model.set(a.dataset.field,b)}.bind(this)),this.photoChanged&&this.model.set("photo",d[0].files[0].name),this.model.save(),this.deactivateEditMode()},editPhoto:function(){this.$el.find(".fn-photo-upload")[0].click()},uploadPhoto:function(a){var b=a.target.files[0].type,c=a.target.files[0].name,d=this.$el.find(".photo"),e=d.attr("src").match(/(.*\/)/g);b.indexOf("image/")>-1?c!==this.model.get("photo")&&(this.photoChanged=!0,d.attr("src",e+c)):console.log("File uploaded is not an image")},handleRemoveContact:function(){this.overlay.removeClass("hidden")},removeContactCancel:function(){this.overlay.addClass("hidden")},removeContact:function(){this.model.destroy()}})});